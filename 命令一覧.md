# 命令一覧
### PaSoRi開く
Felica.dll (Felicalib) をロード、初期化します。    

### PaSoRi初期化
名の通り、PaSoRiを初期化します。**Felicaを読み込む前に必要となる行為です。**  
初期化に成功すると、0が返ってきます。  

### PaSoRi閉じる
名の通り、PaSoRiとの通信を終了します。  
これにより、Felica.dllが解放されます。   

### Felica取得
FeliCaカードが置かれているか確認する命令です。
カードがないと、0.5秒間待機したのちに、再度読み取りを繰り返し続けます。
今のところ、タイムアウト設定はできません。
(Ver 0.4で実装します)

書式は下記の通りです。  

~~~
部品名からTYPEのFelica取得
~~~
このTYPEには  
- POLLING_ANY → なんでも読み込みます  
- POLLING_EDY → EDYを読み込みます  
- POLLING_SUICA → 交通系ICを読み込みます  

のいずれかが入ります。  

### Felica解放
Felicaハンドルを解放します。 
別のカードを読み出す際や，通信に失敗した場合はこれを呼び出してから再度Felica取得命令を使用する必要があります。   

### Felica製造ID取得
FelicaのIDm (製造ID) を取得します。  
これの返り値には、IDmが含まれています。

### Felica製造パラメータ取得
FelicaのPMm (製造パラメータ) を取得します。  
これの返り値には、PMmが含まれています。 

### Felica非暗号化塊読み込み
Felicaの暗号化されていないブロックを取得します。  
Suicaの履歴とかを読み込む際に使えます。  
これの返り値には、16バイトの16進数の数字が返ってきます。  
書式は下記の通りです。  
~~~
部品名からNUMのTYPEをFelica製造パラメータ取得
~~~
NUMには、読み込みたいブロック番号が入ります。(0~255)  
TYPEにはサービスコードが入ります。任意の値か、下記の変数を代入できます。

- SERVICE_SUICA_HISTORY → 交通系ICカードの履歴ブロックを読みます  
- SERVICE_NANACO_HISTORY → nanacoの履歴を読みます。
- SERVICE_EDY_HISTORY → Edyの履歴を読みます。

## エラー類諸々 
### 「PaSoRi/Felicaハンドルが空です」

PaSoRi開く・Felica取得せずに、命令を叩こうとしていませんか？
Ver 0.3.0以降、部品グループ内部にハンドル番号を保管する都合上、各命令を実行する前に必ずPaSoRiとFelicaハンドルが存在するか (=PaSoRi開く、Felica取得命令を実行したか) 確認するようになっています。

それでもおかしい場合はバグです。申し訳ありませんが、作者に連絡してください。

### 「PaSoRiの初期化に失敗しました」

これは、PaSoRiが接続されていない際に発生します。  
USB接続型PaSoRiの場合、正常に接続されているか、ご確認ください。  

### 「Felicaのブロックの読み込みに失敗しました」
このエラーはFelica非暗号化塊読み込みで発生します。  
これは、カードが読み込めないと発生します。  

### フリーズした/応答しなくなった

PaSoRiを初期化せずにFelicaを読み取ろうとすると、確実にフリーズします。
また、Ver 0.3.0においては、カードが無いのに読み取ろうとすると、タイムアウトせずに永久に読もうとするので、それでフリーズする可能性はあります。この問題はVer 0.4までには修正する予定です。

必ず初期化しましょう。